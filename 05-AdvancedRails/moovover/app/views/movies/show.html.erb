<%= render @movie %>

<%# Reviews section - demonstrating associations (ESaaS Â§5.3, Â§5.4) %>
<div class="card mt-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Reviews (<%= @movie.reviews.count %>)</h5>
    <%= link_to "Write a Review", new_movie_review_path(@movie), class: "btn btn-sm btn-primary" %>
  </div>
  <div class="card-body">
    <% if @movie.reviews.any? %>
      <% @movie.reviews.includes(:moviegoer).limit(3).each do |review| %>
        <div class="mb-2">
          <strong>
            <% review.potatoes.times do %>ðŸ¥”<% end %>
          </strong>
          <small class="text-muted">
            by <%= review.moviegoer.name || 'Anonymous' %>
          </small>
        </div>
      <% end %>
      <% if @movie.reviews.count > 3 %>
        <p class="text-muted">
          <%= link_to "See all #{@movie.reviews.count} reviews...", movie_reviews_path(@movie) %>
        </p>
      <% end %>
    <% else %>
      <p class="text-muted mb-0">No reviews yet. Be the first!</p>
    <% end %>
  </div>
</div>

<div class="mt-4">
  <%= link_to "Edit this movie", edit_movie_path(@movie), class: "btn btn-secondary" %> |
  <%= link_to "All Reviews", movie_reviews_path(@movie), class: "btn btn-info" %> |
  <%= link_to "Back to movies", movies_path, class: "btn btn-link" %>

  <%= button_to "Destroy this movie", @movie, method: :delete, class: "btn btn-danger",
      data: { turbo_confirm: "Are you sure? This will also delete all reviews (dependent: :destroy)." } %>
</div>

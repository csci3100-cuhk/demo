<%#
  This file is app/views/movies/index.html.erb

  ESaaS §6.1 - Progressive Enhancement:
  This page works WITHOUT JavaScript (all links are standard Rails links).
  With JavaScript enabled, the page is ENHANCED with:
    - "Select All" checkbox (§6.6 - Events & Callbacks)
    - "Quick View" AJAX popup (§6.7 - AJAX)
    - Keyboard-accessible interactions (§6.5 - Accessibility)

  §6.1: "Browsers with JS disabled should get a usable experience"
%>

<%# Accessibility (§6.5): Use heading hierarchy for page structure %>
<h1>Movies</h1>

<%#
  §6.6 - Events & Callbacks: "Select All" Checkbox
  The checkbox triggers the toggleSelectAll handler defined in movie_popup.js.
  Without JS, the checkboxes still render but don't have bulk actions.

  §6.5 - Form Inputs Need Labels!
  Every form input must have a label. The label's "for" attribute
  must match the input's "id" attribute.
%>
<div class="mb-3 d-flex align-items-center gap-3">
  <div class="form-check">
    <input type="checkbox" id="select-all-movies" class="form-check-input"
           aria-label="Select all movies">
    <label for="select-all-movies" class="form-check-label fw-bold">
      Select All
    </label>
  </div>
  <span id="selected-count" class="badge bg-secondary" style="display: none;"
        aria-live="polite">
    <%# Updated dynamically by JS (§6.4 - jQuery .text() modifies content) %>
  </span>
</div>

<%#
  §6.5 - Accessibility: Using Semantic HTML
  Use <table> for tabular data (not <div>s). Screen readers understand
  table structure and can navigate by rows/columns.
  The aria-label provides context for assistive technology.
%>
<table class="table table-hover" id="movies-table" aria-label="List of movies">
  <thead>
    <tr>
      <th scope="col" class="select-col">
        <span class="visually-hidden">Select</span>
      </th>
      <th scope="col">Title</th>
      <th scope="col">Rating</th>
      <th scope="col">Release Date</th>
      <th scope="col">Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @movies.each do |movie| %>
      <tr class="movie-row" id="movie-row-<%= movie.id %>">
        <%# §6.5 - Labels: Each checkbox needs a label %>
        <td>
          <input type="checkbox" class="form-check-input movie-checkbox"
                 id="movie-check-<%= movie.id %>"
                 value="<%= movie.id %>"
                 aria-label="Select <%= movie.title %>"
                 onchange="MoviePopup.updateSelectedCount()">
        </td>
        <td>
          <strong><%= movie.title %></strong>
        </td>
        <td>
          <% if movie.rating.present? %>
            <span class="badge bg-info"><%= movie.rating %></span>
          <% end %>
        </td>
        <td><%= movie.release_date %></td>
        <td>
          <%#
            §6.7 - AJAX: "Quick View" link
            This link has two behaviors:
              1. WITHOUT JS: navigates to the show page (standard Rails link)
              2. WITH JS: opens an AJAX popup (progressive enhancement!)

            The data-movie-id attribute stores the movie ID for the JS handler.
            The class "movie-popup-link" is used by jQuery event delegation
            in movie_popup.js to bind the click handler.
          %>
          <%= link_to "Quick View", movie_path(movie),
                class: "btn btn-sm btn-outline-primary movie-popup-link",
                data: { movie_id: movie.id },
                aria_label: "Quick view of #{movie.title}" %>
          <%= link_to "Details", movie_path(movie),
                class: "btn btn-sm btn-secondary",
                aria_label: "View full details of #{movie.title}" %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="mt-3">
  <%= link_to "New movie", new_movie_path, class: "btn btn-success" %>
</div>
